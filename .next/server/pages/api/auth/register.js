"use strict";(()=>{var a={};a.id=443,a.ids=[443],a.modules={2518:a=>{a.exports=require("mongodb")},3139:a=>{a.exports=import("bcryptjs")},3216:(a,b,c)=>{c.d(b,{A:()=>f});var d=c(2518);require("dotenv").config({path:".env.local"});let e="mongodb+srv://alan:asdfghj@cluster0.9xd5ghg.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0";if(!e)throw Error("⚠️  MONGODB_URI no est\xe1 definido en el archivo .env");let f=new d.MongoClient(e,{}).connect()},4411:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>g});var e=c(6182),f=a([e]);async function g(a,b){if("POST"!==a.method)return b.status(405).json({error:"M\xe9todo no permitido"});try{let{username:c,password:d,nombre_completo:f,genero:g,rfc:h,curp:i,categoria:j,grado_academico:k,antig_carrera:l,antig_unam:m,correo:n,tel_casa:o,celular:p,direccion:q}=a.body;if(!c||!d||!f||!n)return b.status(400).json({error:"Username, password, nombre completo y correo son requeridos"});if(await e.l.findByUsername(c))return b.status(400).json({error:"El profesor ya existe"});if(await e.l.findByEmail(n))return b.status(400).json({error:"Ya existe un profesor con este correo"});if(h&&await e.l.findByRFC(h))return b.status(400).json({error:"Ya existe un profesor con este RFC"});if(i&&await e.l.findByCURP(i))return b.status(400).json({error:"Ya existe un profesor con este CURP"});let r=await e.l.hashPassword(d),s=new e.l({username:c,password_hash:r,nombre_completo:f,genero:g,rfc:h,curp:i,categoria:j,grado_academico:k,antig_carrera:l,antig_unam:m,correo:n,tel_casa:o,celular:p,direccion:q}),t=await s.save();b.status(201).json({message:"Profesor registrado exitosamente",profesorId:t.insertedId.toString()})}catch{console.error("Error en registro:"),b.status(500).json({error:"Error interno del servidor"})}}e=(f.then?(await f)():f)[0],d()}catch(a){d(a)}})},5600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6182:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{l:()=>i});var e=c(3216),f=c(2518),g=c(3139),h=a([g]);g=(h.then?(await h)():h)[0];class i{constructor(a){this.nombre_completo=a.nombre_completo,this.genero=a.genero,this.rfc=a.rfc,this.curp=a.curp,this.categoria=a.categoria,this.grado_academico=a.grado_academico,this.antig_carrera=a.antig_carrera,this.antig_unam=a.antig_unam,this.correo=a.correo,this.tel_casa=a.tel_casa,this.celular=a.celular,this.direccion=a.direccion,this.username=a.username,this.password_hash=a.password_hash,this.role="profesor",this.created_at=new Date,this.updated_at=new Date}static async getCollection(){return(await e.A).db("profesores").collection("profesores")}async save(){let a=await i.getCollection();return await a.insertOne(this)}static async findById(a){let b=await i.getCollection();return await b.findOne({_id:new f.ObjectId(a)})}static async findAll(){let a=await i.getCollection();return await a.find({}).toArray()}static async updateById(a,b){let c=await i.getCollection();return b.updated_at=new Date,await c.updateOne({_id:new f.ObjectId(a)},{$set:b})}static async deleteById(a){let b=await i.getCollection();return await b.deleteOne({_id:new f.ObjectId(a)})}static async findByEmail(a){let b=await i.getCollection();return await b.findOne({correo:a})}static async findByRFC(a){let b=await i.getCollection();return await b.findOne({rfc:a})}static async findByCURP(a){let b=await i.getCollection();return await b.findOne({curp:a})}static async findByUsername(a){let b=await i.getCollection();return await b.findOne({username:a})}static async updateByUsername(a,b){let c=await i.getCollection();return b.updated_at=new Date,await c.updateOne({username:a},{$set:b})}static async deleteByUsername(a){let b=await i.getCollection();return await b.deleteOne({username:a})}static async hashPassword(a){return await g.default.hash(a,12)}static async verifyPassword(a,b){return await g.default.compare(a,b)}}d()}catch(a){d(a)}})},7191:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>o,default:()=>n,handler:()=>m});var e=c(1089),f=c(8698),g=c(5807),h=c(8806),i=c(4411),j=c(8869),k=c(337),l=a([i]);i=(l.then?(await l)():l)[0];let n=(0,h.M)(i,"default"),o=(0,h.M)(i,"config"),p=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/auth/register",pathname:"/api/auth/register",bundlePath:"",filename:""},userland:i,distDir:".next",relativeProjectDir:""});async function m(a,b,c){let d=await p.prepare(a,b,{srcPage:"/api/auth/register"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h,routerServerContext:i}=d;try{let c=a.method||"GET",d=(0,j.getTracer)(),e=d.getActiveScopeSpan(),l=p.instrumentationOnRequestError.bind(p),m=async e=>p.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:h.preview,propagateError:!1,dev:p.isDev,page:"/api/auth/register",internalRevalidate:null==i?void 0:i.revalidate,onError:(...b)=>l(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==k.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await m(e):await d.withPropagatedContext(a.headers,()=>d.trace(k.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:j.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},m))}catch(a){if(p.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}d()}catch(a){d(a)}})}};var b=require("../../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[833],()=>b(b.s=7191));module.exports=c})();