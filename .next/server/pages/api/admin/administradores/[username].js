"use strict";(()=>{var a={};a.id=21,a.ids=[21],a.modules={1841:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>h});var e=c(3241),f=c(4683),g=a([f]);async function h(a,b){try{let c=(0,e.fV)(a,b);if(c.error)return b.status(c.status).json({error:c.error});let{username:d}=a.query;if("PUT"===a.method){let{password:c}=a.body;if(!c)return b.status(400).json({error:"Password es requerido"});let e={password_hash:await f.G.hashPassword(c)},g=await f.G.updateByUsername(d,e);if(0===g.matchedCount)return b.status(404).json({error:"Administrador no encontrado"});b.status(200).json({mensaje:"Administrador actualizado correctamente"})}else if("DELETE"===a.method){if((await f.G.findAll()).length<=1)return b.status(400).json({error:"No se puede eliminar el \xfaltimo administrador"});let a=await f.G.deleteByUsername(d);if(0===a.deletedCount)return b.status(404).json({error:"Administrador no encontrado"});b.status(200).json({mensaje:"Administrador eliminado"})}else b.status(405).json({error:"M\xe9todo no permitido"})}catch(a){console.error("Error en gesti\xf3n individual de administrador:",a),b.status(500).json({error:"Error interno del servidor"})}}f=(g.then?(await g)():g)[0],d()}catch(a){d(a)}})},2518:a=>{a.exports=require("mongodb")},3139:a=>{a.exports=import("bcryptjs")},3216:(a,b,c)=>{c.d(b,{A:()=>f});var d=c(2518);require("dotenv").config({path:".env.local"});let e="mongodb+srv://alan:asdfghj@cluster0.9xd5ghg.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0";if(!e)throw Error("⚠️  MONGODB_URI no est\xe1 definido en el archivo .env");let f=new d.MongoClient(e,{}).connect()},3241:(a,b,c)=>{c.d(b,{Ey:()=>f,fV:()=>i,Vw:()=>h});let d=require("jsonwebtoken"),e="tu_clave_secreta_jwt_muy_segura_aqui";function f(a){return d.sign(a,e,{expiresIn:1800})}function g(a,b,c=null){let f=function(a){let b=a.headers.authorization;return b&&b.startsWith("Bearer ")?b.substring(7):null}(a);if(!f)return{error:"Token no proporcionado",status:401};let h=function(a){try{return d.verify(a,e)}catch{return null}}(f);return h?c&&h.role!==c?{error:"Permisos insuficientes",status:403}:{user:h}:{error:"Token inv\xe1lido",status:401}}function h(a,b){return g(a,b,"profesor")}function i(a,b){return g(a,b,"admin")}},4683:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{G:()=>i});var e=c(3216),f=c(2518),g=c(3139),h=a([g]);g=(h.then?(await h)():h)[0];class i{constructor(a){this.username=a.username,this.password_hash=a.password_hash,this.role="admin",this.created_at=new Date,this.updated_at=new Date}static async getCollection(){return(await e.A).db("profesores").collection("administradores")}async save(){let a=await i.getCollection();return await a.insertOne(this)}static async findByUsername(a){let b=await i.getCollection();return await b.findOne({username:a})}static async findById(a){let b=await i.getCollection();return await b.findOne({_id:new f.ObjectId(a)})}static async findAll(){let a=await i.getCollection();return await a.find({}).toArray()}static async updateByUsername(a,b){let c=await i.getCollection();return b.updated_at=new Date,await c.updateOne({username:a},{$set:b})}static async deleteByUsername(a){let b=await i.getCollection();return await b.deleteOne({username:a})}static async hashPassword(a){return await g.default.hash(a,12)}static async verifyPassword(a,b){return await g.default.compare(a,b)}static async createDefaultAdmin(){if(!await i.findByUsername("admin")){let a=await i.hashPassword("admin123"),b=new i({username:"admin",password_hash:a});return await b.save()}return null}}d()}catch(a){d(a)}})},5600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6983:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>o,default:()=>n,handler:()=>m});var e=c(1089),f=c(8698),g=c(5807),h=c(8806),i=c(1841),j=c(8869),k=c(337),l=a([i]);i=(l.then?(await l)():l)[0];let n=(0,h.M)(i,"default"),o=(0,h.M)(i,"config"),p=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/admin/administradores/[username]",pathname:"/api/admin/administradores/[username]",bundlePath:"",filename:""},userland:i,distDir:".next",relativeProjectDir:""});async function m(a,b,c){let d=await p.prepare(a,b,{srcPage:"/api/admin/administradores/[username]"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h,routerServerContext:i}=d;try{let c=a.method||"GET",d=(0,j.getTracer)(),e=d.getActiveScopeSpan(),l=p.instrumentationOnRequestError.bind(p),m=async e=>p.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:h.preview,propagateError:!1,dev:p.isDev,page:"/api/admin/administradores/[username]",internalRevalidate:null==i?void 0:i.revalidate,onError:(...b)=>l(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==k.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await m(e):await d.withPropagatedContext(a.headers,()=>d.trace(k.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:j.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},m))}catch(a){if(p.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}d()}catch(a){d(a)}})}};var b=require("../../../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[833],()=>b(b.s=6983));module.exports=c})();